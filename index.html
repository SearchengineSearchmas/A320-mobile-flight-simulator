<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>A320 Mobile Flight Simulator</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: black;
  touch-action: none;
}
#ui {
  position: fixed;
  top: 10px;
  left: 10px;
  z-index: 10;
}
button {
  font-size: 16px;
  padding: 10px;
  margin-bottom: 6px;
}
</style>
</head>

<body>

<div id="ui">
  <button id="tiltBtn">Enable Tilt</button>
  <button id="viewBtn">Change View</button>
</div>

<script type="module">
import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.160/build/three.module.js";

let scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

// Cameras
let camCockpit = new THREE.PerspectiveCamera(70, innerWidth/innerHeight, 0.1, 5000);
let camExternal = new THREE.PerspectiveCamera(70, innerWidth/innerHeight, 0.1, 5000);
let camera = camExternal;
let camMode = 0;

// Light
scene.add(new THREE.HemisphereLight(0xffffff, 0x444444, 1.3));

// Ground
let ground = new THREE.Mesh(
  new THREE.PlaneGeometry(20000,20000),
  new THREE.MeshStandardMaterial({color:0x1f7a1f})
);
ground.rotation.x = -Math.PI/2;
scene.add(ground);

// Aircraft (A320 placeholder â€“ replace with model later)
let plane = new THREE.Group();

let body = new THREE.Mesh(
  new THREE.CylinderGeometry(1.5,1.5,20,16),
  new THREE.MeshStandardMaterial({color:0xffffff})
);
body.rotation.z = Math.PI/2;
plane.add(body);

let wing = new THREE.Mesh(
  new THREE.BoxGeometry(16,0.3,3),
  new THREE.MeshStandardMaterial({color:0xcccccc})
);
plane.add(wing);

plane.position.y = 200;
scene.add(plane);

// Cockpit camera
camCockpit.position.set(0,1,2);
plane.add(camCockpit);

// External camera
camExternal.position.set(0,10,40);
camExternal.lookAt(plane.position);

// Flight variables
let speed = 2;
let pitch = 0, roll = 0;

// Tilt controls
document.getElementById("tiltBtn").onclick = async () => {
  if (typeof DeviceOrientationEvent !== "undefined" &&
      typeof DeviceOrientationEvent.requestPermission === "function") {
    await DeviceOrientationEvent.requestPermission();
  }

  window.addEventListener("deviceorientation", e => {
    pitch = e.beta * 0.002;
    roll  = e.gamma * 0.002;
  });
};

// View switch
document.getElementById("viewBtn").onclick = () => {
  camMode = (camMode + 1) % 2;
  camera = camMode === 0 ? camExternal : camCockpit;
};

// Animate
function animate(){
  requestAnimationFrame(animate);

  plane.rotation.x += pitch;
  plane.rotation.z -= roll;
  plane.translateZ(-speed);

  renderer.render(scene, camera);
}
animate();

// Resize
window.onresize = () => {
  renderer.setSize(innerWidth, innerHeight);
  camera.aspect = innerWidth / innerHeight;
  camera.updateProjectionMatrix();
};
</script>

</body>
</html>

