<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>A320 flight</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<style>
html, body { margin:0; height:100%; overflow:hidden; background:#87ceeb; }
canvas { display:block; }

#hud{
  position:fixed; left:10px; top:10px;
  background:rgba(0,0,0,.45); color:#fff;
  font-family:sans-serif; padding:8px 10px; border-radius:8px;
  font-size:14px;
}

#throttleBar{
  position:fixed; right:15px; bottom:90px;
  width:34px; height:220px; background:#222;
  border-radius:18px; border:2px solid #555;
  touch-action:none;
}
#throttleKnob{
  position:absolute; left:0; width:100%; height:34px;
  background:#00ff88; border-radius:18px; bottom:40%;
}

#joy{position:fixed; left:20px; bottom:80px;width:110px;height:110px;background:rgba(0,0,0,.25);border-radius:50%;touch-action:none;}
#joyDot{position:absolute; left:40px; top:40px; width:30px; height:30px; border-radius:50%; background:#fff;}

#crashOverlay{
  position:fixed; inset:0; display:none; z-index:100;
  background:rgba(0,0,0,0.75);
  color:#fff; font-size:3rem; font-weight:bold;
  display:flex; justify-content:center; align-items:center;
  font-family:sans-serif; text-align:center;
}
</style>
</head>
<body>

<div id="hud">Throttle: <span id="th">40%</span><br>Status: <span id="st">AIR</span></div>
<div id="joy"><div id="joyDot"></div></div>
<div id="throttleBar"><div id="throttleKnob"></div></div>
<div id="crashOverlay">GAME OVER<br>Restarting...</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script>
/* SCENE SETUP */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

const camera = new THREE.PerspectiveCamera(70, innerWidth/innerHeight, 0.1, 2000);
camera.position.set(0,2.2,0);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

window.addEventListener('resize', ()=>{
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
});

/* LIGHTS */
scene.add(new THREE.HemisphereLight(0xffffff, 0x444444, 1.0));
const sun = new THREE.DirectionalLight(0xffffff, 0.8);
sun.position.set(50,100,20);
scene.add(sun);

/* GROUND */
const ground = new THREE.Mesh(
  new THREE.PlaneGeometry(2000,2000),
  new THREE.MeshStandardMaterial({color:0x4caf50})
);
ground.rotation.x=-Math.PI/2;
scene.add(ground);

/* AIRPORT */
const runway = new THREE.Mesh(
  new THREE.BoxGeometry(220,1,18),
  new THREE.MeshStandardMaterial({color:0x333333})
);
runway.position.set(0,0.5,-200);
scene.add(runway);

const terminal = new THREE.Mesh(
  new THREE.BoxGeometry(30,12,18),
  new THREE.MeshStandardMaterial({color:0xdddddd})
);
terminal.position.set(30,6,-200);
scene.add(terminal);

/* BUILDINGS FAR AWAY FROM START */
const buildings=[];
for(let i=0;i<10;i++){
  const b = new THREE.Mesh(
    new THREE.BoxGeometry(8,20,8),
    new THREE.MeshStandardMaterial({color:0x888888})
  );
  b.position.set(Math.random()*100-50,10,-300 - Math.random()*200 - 50); // far enough from start
  scene.add(b);
  buildings.push(b);
}

/* PLANE */
const plane = new THREE.Group();
const body = new THREE.Mesh(
  new THREE.CylinderGeometry(0.6,0.8,6,16),
  new THREE.MeshStandardMaterial({color:0xffffff})
);
body.rotation.z=Math.PI/2;
plane.add(body);
const wing = new THREE.Mesh(
  new THREE.BoxGeometry(0.2,6,1),
  new THREE.MeshStandardMaterial({color:0xcccccc})
);
plane.add(wing);
plane.position.set(0,15,0);
scene.add(plane);

/* CONTROLS */
let throttle=0.4,speed=0;
const MAX_SPEED=18,STALL_SPEED=2;
let pitchInput=0;
let landed=false, boarding=false, crashed=false;

/* KEYBOARD */
addEventListener('keydown', e=>{
  if(e.key.toLowerCase()==='w') throttle=Math.min(1,throttle+0.04);
  if(e.key.toLowerCase()==='s') throttle=Math.max(0,throttle-0.04);
});

/* MOBILE THROTTLE */
const bar=document.getElementById('throttleBar');
const knob=document.getElementById('throttleKnob');
bar.addEventListener('touchmove',e=>{
  const r=bar.getBoundingClientRect();
  let y=e.touches[0].clientY-r.top;
  y=Math.max(0,Math.min(r.height,y));
  throttle=1-(y/r.height);
  knob.style.bottom=(throttle*100)+'%';
},{passive:false});

/* MOBILE JOYSTICK */
const joy=document.getElementById('joy');
const dot=document.getElementById('joyDot');
joy.addEventListener('touchmove', e=>{
  const r=joy.getBoundingClientRect();
  const y = e.touches[0].clientY - r.top - 55;
  const dy = Math.max(-35, Math.min(35, y));
  dot.style.top = (55+dy-15)+'px';
  pitchInput=-dy/35;
},{passive:false});
joy.addEventListener('touchend',()=>{dot.style.top='40px'; pitchInput=0;});

/* CRASH OVERLAY */
const overlay = document.getElementById('crashOverlay');
function triggerCrash(){
  if(crashed) return;
  crashed=true;
  overlay.style.display='flex';
  setTimeout(()=>location.reload(),3000);
}

/* ANIMATION LOOP */
function animate(){
  requestAnimationFrame(animate);
  if(crashed) return;

  // speed
  speed += ((throttle*MAX_SPEED)-speed)*0.05;

  // pitch
  plane.rotation.x += pitchInput*0.02;

  // forward
  plane.translateZ(-speed*0.05);

  // stall
  if(speed<STALL_SPEED && plane.position.y>2) plane.position.y-=0.15;

  // crash detection
  if(plane.position.y<=2) triggerCrash(); // ground
  buildings.forEach(b=>{
    const dx = plane.position.x - b.position.x;
    const dy = plane.position.y - b.position.y;
    const dz = plane.position.z - b.position.z;
    const dist = Math.sqrt(dx*dx + dy*dy + dz*dz);
    if(dist<4) triggerCrash();
  });

  // runway landing
  const dx = Math.abs(plane.position.x-runway.position.x);
  const dz = Math.abs(plane.position.z-runway.position.z);
  if(dx<9 && dz<110 && plane.position.y<=2.1 && speed<4) landed=true;

  // auto stop
  if(landed){
    throttle=Math.max(0,throttle-0.02);
    if(speed<0.2 && !boarding) boarding=true;
  }

  // cockpit camera
  camera.position.copy(plane.position);
  camera.rotation.copy(plane.rotation);

  // HUD
  document.getElementById('th').textContent=Math.round(throttle*100)+'%';
  document.getElementById('st').textContent = landed?'LANDED':'AIR';

  renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>
